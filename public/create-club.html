<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>TBC - Create Club</title>
    <meta name="description" content="View upcoming meeting info and the current book.">

    <!-- Bootstrap 5 CSS CDN link -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <!-- My Style Sheet -->
    <link rel="stylesheet" href="styles.css">
</head>

<body class="text-center">
    <!-- Mobile Nav -->
    <nav class="mobile-nav">
        <div id="menu-links">
            <a href="index.html">Home</a>
            <a href="search.html">Search</a>
            <a href="club.html?id=e2aba750fd744955b539b01cc21af326">Club</a>
            <a href="book.html?id=nDjRDwAAQBAJ">Book</a>
            <a href="discussion.html">Discussion</a>
            <a href="my-profile.html">My Profile</a>
        </div>

        <a class="menu-icon" onclick="hamburger()">
            <div>&#9776;</div>
        </a>
    </nav>

    <header>Teacher Book Club</header>

    <!-- Tablet & Desktop Nav -->
    <nav class="tablet-desktop">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="search.html">Search</a></li>
            <li><a href="club.html?id=e2aba750fd744955b539b01cc21af326">Club</a></li>
            <li><a href="book.html?id=nDjRDwAAQBAJ">Book</a></li>
            <li><a href="discussion.html">Discussion</a></li>
            <li><a href="my-profile.html">My Profile</a></li>
        </ul>
    </nav>

    <main class="container text-center">
        On this page, users will be able to use Chat GPT to generate discussion questions.

        <!-- https://getbootstrap.com/docs/5.3/layout/columns/ -->
        <section class="section1">
            <h1 id="club-heading">Section 1</h1>

            <div class="row">

                <div class="col club-left">
                    <img
                        src="http://books.google.com/books/content?id=OYtkbGl2j0sC&printsec=frontcover&img=1&zoom=5&edge=curl&source=gbs_api">
                    <h2>Fahrenheit 451</h2>
                </div>

                <div class="col club-right">
                    <h3>Guiding Questions</h3>
                    <textarea id="club-thumbnail" class="thumbnail">Content</textarea>
                    <button onclick="loadClub()" type="button" class="btn btn-primary">Ask AI to generate
                        questions</button>
                </div>

            </div>

        </section>

        <section class="section2">
            <h1>ChatGPT API</h1>

            <div class="row">
                <form action="">
                    <input type="text" mame="message" id="message">
                    <button type="submit">Send</button>
                </form>

                <div id="chat-log"></div>
            </div>

        </section>

    </main>

    <footer>Copyright 2023</footer>

    <!-- <script src="script.js"></script> -->
    <script>
        let messages = [
            // Just a reference for how user and assistant messages should be structured
            // {"role": "user", "content": "Who won the world series in 2020?"},
            // {"role": "assistant", "content": "The Los Angeles Dodgers won the World Series in 2020."},
        ];
        const chatLog = document.getElementById("chat-log");
        const message = document.getElementById("message");
        const form = document.querySelector("form");

        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const messageText = message.value;
            const newMessage =
                { "role": "user", "content": `${messageText}` };
            messages.push(newMessage);
            message.value = "";
            const messageElement = document.createElement("div");
            messageElement.classList.add("message");
            messageElement.classList.add("message--sent");
            messageElement.innerHTML = `
                <div class="message__text">${messageText}</div>
            `;
            chatLog.appendChild(messageElement);
            chatLog.scrollTop = chatLog.scrollHeight;
            fetch("http://localhost:3000", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    messages
                })
            })
                .then(res => res.json())
                .then(data => {
                    let newAssistantMessage = {
                        "role": "assistant", "content": `${data.completion.content}`
                    };
                    messages.push(newAssistantMessage);
                    const messageElement = document.createElement("div");
                    messageElement.classList.add("message");
                    messageElement.classList.add("message--received");
                    messageElement.innerHTML = `
                    <div class="message__text">${data.completion.content}</div>
                `;
                    chatLog.appendChild(messageElement);
                    chatLog.scrollTop = chatLog.scrollHeight;
                })
        })
    </script>

</body>

</html>